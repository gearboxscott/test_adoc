ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

include::vars/render-vars.adoc[]
include::vars/document-vars.adoc[]
include::vars/redhat-vars.adoc[]
include::vars/customer-vars.adoc[]
include::locale/attributes.adoc[]

// Adding logo to the coverpage.
// Change the pdfwidth to improve embedding
// ifeval::["{customerlogo}" != "empty"]
// :title-logo-image: image:{customerlogo}[pdfwidth=50%,align=center]
// endif::[]

= {subject}

{customer}

{description}

<<<
:toc:
:toc-placement: preamble
:toclevels: 1
:showtitle:


== The Story

A task was presented to create a hardened base image for various cloud virtualization platforms using Ansible, Ansible Automation Platform and Packer.

Packer is predisposition to use OS isos to build servers with either kickstart configuration files for Linux based servers and auto unattended files for Windows based servers. Kickstart and Auto Unattended files can do a lot things during the initialization like add and remove packages, create users, partition disk, etc. It does have it's limitations. After those files are done, they cannot be used again without rebuilding the entire images.

Using Ansible can help here to finish out the build and allow the configuration files to remain in their simpliest state. Ansible can harden the image and coded to with roles that can use on the image and after it been deployed to keep the hardening in place. It can be variablized to allow change that need to happen over time to made easily. Having reusability is one of strengths.

This section will show how Packer will build the initial image, then it will reach out to Ansible Automation Platform to finish up the initial image to install and remove packages, setup and disable users, permissions and fortifications so the image at rest is already hardened before it's deployed in the cloud environment.

The other part of this story is the Packer and Automation workflow is able to produce hardened base images for all types of cloud platforms like VMware, Azure, Amazon and Oracle Cloud.

== Process Flow

##TODO##  Insert process flow diagram here.


== Requirements

The following is a list of requirements that makes this process work:

* A custom execution environment will be required that has Packer installed. The details are in the `Ansible Custom Execution Environment` section below.
*

== Components

== Ansible Custom Execution Environment

The following are files that were used to create the custom execution environment:

The `ansible.cfg` will allow the ansible builder to have access to the Private Automation to pull down collections, etc.

.ansible.cfg
[source,yaml,source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
[defaults]
collections_paths=collections
roles_path=roles/
module_utils=plugins/module_utils
library=plugins/modules
lookup_plugins=plugins/lookup/
stdout_callback = yaml
{vault_password_file}

[galaxy]
server_list = rh-certified_repo, community_repo, published_repo

[galaxy_server.rh-certified_repo]
url=https://{automation_controller}/api/galaxy/content/rh-certified/
token=<redacted>

[galaxy_server.community_repo]
url=https://{automation_controller}/api/galaxy/content/community/
token=<redacted>

[galaxy_server.published_repo]
url=https://{automation_controller}/api/galaxy/content/published/
token=<redacted>
----

This file determines which collection will be preloaded on to the custom execution environment.

.requirements.yml
[source,yaml,source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
# Navigate to https://console.redhat.com/ansible/automation-hub for certified content
# Complete list of certified collections: https://access.redhat.com/articles/3642632

collections:
  - name: ansible.controller
  - name: ansible.netcommon
  - name: ansible.network
  - name: ansible.posix
  - name: ansible.security
  - name: ansible.utils
  - name: ansible.windows
  - name: ansible.yang
  - name: awx.awx
  - name: azure.azcollection
  - name: community.general
  - name: community.hashi_vault
  - name: community.vmware
  - name: community.windows
  - name: redhat.insights
  - name: redhat.rhel_system_roles
  - name: servicenow.itsm
  - name: vmware.vmware_rest
----

This file will make sure required python modules for roles and collections of roles are installed.

.requirements.txt
[source,ini,source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
# Python Dependencies for Ansible Collections
# Only declare dependencies here for modules not already listed in the `requirements.txt`
# that resides within the collection repository. For example:
# Azure Collection python dependencies [requirements.txt]
# https://github.com/ansible-collections/azure/blob/v1.12.0/requirements-azure.txt

# Python Dependencies for Ansible Modules/Roles
# <list them here>

# Other Dependencies
# <list them here>
pip
setuptools
pycdlib

# Windows connectivity requirements - https://docs.ansible.com/ansible/latest/user_guide/windows_winrm.html#what-is-winrm
pywinrm\>=0.3.0
# CIS Windows requirements - https://github.com/ansible-lockdown/Windows-2019-CIS
passlib
lxml
xmltodict
jmespath
# Infoblox requirements - https://docs.ansible.com/ansible/latest/scenario_guides/guide_infoblox.html#prerequisites
infoblox-client
# Mongo requirements
pymongo
# Ansible `replace` module requirements - https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html
selinux
# VMware vSphere requirements - https://github.com/vmware/pyvmomi
pyVmomi
# VMware vCenter dynamic inventory requirements - https://github.com/vmware/vsphere-automation-sdk-python
suds-jurko
git+https://github.com/vmware/vsphere-automation-sdk-python.git
# File required for Azure Collection
packaging
requests[security]
xmltodict
azure-cli-core==2.34.0
azure-common==1.1.11
azure-identity==1.7.0
azure-mgmt-apimanagement==0.2.0
azure-mgmt-authorization==2.0.0
azure-mgmt-batch==5.0.1
azure-mgmt-cdn==11.0.0
azure-mgmt-compute==26.1.0
azure-mgmt-containerinstance==9.0.0
azure-mgmt-core==1.3.0
azure-mgmt-containerregistry==9.1.0
azure-containerregistry==1.0.0
azure-mgmt-containerservice==20.0.0
azure-mgmt-datalake-store==1.0.0
azure-mgmt-datafactory==2.0.0
azure-mgmt-dns==8.0.0
azure-mgmt-marketplaceordering==0.1.0
azure-mgmt-monitor==3.0.0
azure-mgmt-managedservices==6.0.0
azure-mgmt-managementgroups==0.2.0
azure-mgmt-network==19.1.0
azure-mgmt-nspkg==2.0.0
azure-mgmt-privatedns==1.0.0
azure-mgmt-redis==13.0.0
azure-mgmt-resource==10.2.0
azure-mgmt-rdbms==10.0.0
azure-mgmt-search==8.0.0
azure-mgmt-servicebus==7.1.0
azure-mgmt-sql==3.0.1
azure-mgmt-storage==19.0.0
azure-mgmt-trafficmanager==1.0.0b1
azure-mgmt-web==6.1.0
azure-nspkg==2.0.0
azure-storage-blob==12.11.0
msrest==0.7.1
msrestazure==0.6.4
azure-keyvault==1.1.0
azure-mgmt-keyvault==10.0.0
azure-graphrbac==0.61.1
azure-mgmt-cosmosdb==6.4.0
azure-mgmt-hdinsight==9.0.0
azure-mgmt-devtestlabs==3.0.0
azure-mgmt-loganalytics==12.0.0
azure-mgmt-automation==1.0.0
azure-mgmt-iothub==2.2.0
azure-mgmt-recoveryservices==2.0.0
azure-mgmt-recoveryservicesbackup==3.0.0
azure-mgmt-notificationhubs==7.0.0
azure-mgmt-eventhub==10.1.0
voluptuous==0.13.1
pycodestyle==2.8.0
yamllint==1.26.3
cryptography==38.0.1
pylint==2.13.5

# add for spacewalk to work
libxml2-python3
----

The system entry in the definition points to a bindep requirements file, which will install system-level dependencies that are outside of what the collections already include as their dependencies. It may be listed as a relative path from the directory of the automation execution environment definition’s folder, or an absolute path.

[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
dnf [platform:rpm]
git [platform:rpm]
jq [platform:rpm]
----

.bindep.txt

The `execution-environment.yml` is the main file that tells the Ansible Builder how to build the custom execution environment:

.execution-environment.yml
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
version: 1

build_arg_defaults:
  # Ignore certificatons (verify_ssl=false)
  #
  ANSIBLE_GALAXY_CLI_COLLECTION_OPTS: "-v"

  # Execution Environment Base Image
  EE_BASE_IMAGE: "sdatmhub.reyesholdings.com/ee-supported-rhel8:latest"

ansible_config: 'ansible.cfg'

dependencies:
  # Ansible dependencies
  # Pull down ansible roles and collections required by your playbooks
  galaxy: requirements.yml

  # Python requirements
  # Reference ansible collections to know what python packages you need
  # Only declare python modules that are outside of the `requirements.txt` that
  # already exists in the collection repo. That requirements.txt will be automatically
  # picked up and installed within the image.
  python: requirements.txt

  # System binary depenencies - system packages you want to include into the image
  # Packages are pulled from ubi repositories https://access.redhat.com/articles/4238681
  # Examples are zip, dnf, and other tools
  system: bindep.txt

additional_build_steps:
  # ANSIBLE-BUILDER PREPEND - START
  prepend: |
    RUN whoami
    RUN cat /etc/os-release
  # ANSIBLE-BUILDER PREPEND - END

  append:
  # ANSIBLE-BUILDER APPEND - START
    - RUN echo This is a post-install command!
    - RUN dnf install unzip  --assumeyes
    - RUN dnf install -y yum-utils
    - RUN yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo --assumeyes
    - RUN dnf install packer --assumeyes
    - RUN dnf install sudo --assumeyes
    - RUN useradd --password redhat1234! pacman
    - RUN touch /etc/sudoers.d/pacman
    - RUN echo 'pacman ALL=(ALL) ALL' > /etc/sudoers.d/pacman
    - RUN chmod 644 /etc/sudoers.d/pacman
    - RUN dnf install genisoimage --assumeyes

  # ANSIBLE-BUILDER APPEND - END

...
----

After these file were created and it's recommended that these file are storaged in a repository under version control. These files will be updated over time to update the version of all the components that on this execution environment. The next step is to build the new custom execution environment. The following are the step used to build the custom execution environment:

Steps:

. Login into the Private Automation Hub's registry using `podman`:
+
.Log into Private Automation Hub registry.
[source,bash,linenums,options="nowrap",subs="attributes,verbatim"]
----
$ podman login -u=username automation-hub-url
----

. Pull down a current Execution Environment like ee-supported-rhel8:latest:
+
.Use podman to pull ee-supported-rhel8:latest.
[source,bash,linenums,options="nowrap",subs="attributes,verbatim"]
----
podman pull https://{automation_hub}/ee-supported-rhel8:latest
----

. Login into the Private Automation Hub's registry using `podman`:
+
.Build the new execution environment with ansible-builder.
[source,bash,linenums,options="nowrap",subs="attributes,verbatim"]
----
$ ansible-builder build --file execution-environment.yml --verbosity 3 --container-runtime=podman --tag custom-supported-ee:1.0 --tag custom-supported-ee:latest
----

. Obtain the IMAGE ID for the image that the ansible-builder just generated:
+
.Obtain the image id for the new custom execution environment.
[source,bash,linenums,options="nowrap",subs="attributes,verbatim"]
----
$ podman push images
----

. Pick the image id for `localhost/custom-supported-ee`. Push the new execution environment to the Hub using the image id:
+
.Log into Private Automation Hub registry.
[source,bash,linenums,options="nowrap",subs="attributes,verbatim"]
----
$ podman push <image_id> automationhub/custom-supported-ee
----

. Log into the Controller to add the custom execution environment.

. Click Execution Environments.

. Click **Add** to add new environment.

. Fill in **Name** with `Custom Supported EE`.

. Fill in **Image** with `{automation_hub}/custom-suppor-ee:latest`.

. Select `Always pull container before running` for **Pull**.

. Fill in **Description** with `Use for packer image builds`.

. Leave **Organaization** blank.

. Select `Automation Hub Container Registry` for **Registry credential**.

The Custom Execution Environment is ready to use for building images.

== Inventory Variable Setup

The best way to allow this process to be changed over time is to use variables in all the roles, packer templates, ansible templates, etc. This requires the setup of inventory that will use in the Controller that has variables. The inventory is a project repository that is called into inventory as a source.

The directory tree for inventory look like the following:

[source,bash,linenums,options="nowrap",subs="attributes,verbatim"]
----
.
├── group_vars
│   ├── all
│   │   └── 00-shared.yml
│   ├── linux
│   │   ├── 00-registration.yml
│   │   ├── 00-rhel7-cis.yml
│   │   ├── 00-rhel8-cis.yml
│   │   └── 00-shared-linux.yml
│   ├── win2019
│   │   └── 00-windows-2019-cis.yml
│   └── windows
│       ├── 00-shared-windows.yml
│       └── all.yml
├── host_vars
└── inventory
----

The inventory is setup so there are two groups that used to provision images. Those groups are `linux` and `windows`. Looking at the inventory directory list above, windows has two groups because windows server by the nature have different building requirements. `window2019` is one example that has variable specific to that image. The general `windows` variables file hold variables that are common amoungst all windows images.

Linux could have been done the same way to split them out for images like RHEL, OEL, Ubuntu, etc. For most cases, Linux variations have very little if any uncommon settings other then repository differences.

The other files in those groups of OSes are for different packages that need to be preloaded on the image to make it available for deployment later in Cloud infrastructure.

If the file is only under `linux` then it's only used during linux builds and that's same for windows.

Let look at some of key files in the inventory variable source.

=== File: `00-shared.yml`

This file contains variables for Jinja2 templates that will create Packer Template HCL files, Kickstart Configuration Files, etc.

.00-shared.yml.
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
# 00-shared.yml - inventory variable source

# Packer Build Options <1>
packer_build_force: ''
packer_build_color: false

# Ansible Variables
aap_controller_job_templatem_workflow: Base-Image-Setup-WFJT <2>

controller_job_template_details:
  name: configure_from_aap_controller.yml
  source: configure_from_aap_controller.yml

# Packer Variables

# From Ansible Automation Controller Job template
# either extra_vars or survey questions
packer_vsphere_server: ''        # from survey_packer_vsphere_server
packer_vsphere_datacenter: ''    # from survey_packer_vsphere_datacenter
packer_vsphere_cluster: ''       # from survey_packer_vsphere_cluster
packer_vsphere_network: ''       # from survey_packer_vsphere_network
packer_vsphere_datastore: ''     # from survey_packer_vsphere_datastore
packer_vsphere_folder: ''        # from survey_packer_vsphere_folder

vmware_template_information:
  VMware_RHEL7:
    os_name: rhel7
    template_build_name: 'RHEL7XVMwareHardened'
    template_build_description: 'RHEL 7x Build - Base Image - CIS Level 1 - VMware'
  VMware_RHEL8:
    os_name: rhel8
    template_build_name: 'RHEL8XVMwareHardened'
    template_build_description: 'RHEL 8x Build - Base Image - CIS Level 1 - VMware'
  Windows2019_Updated_Only_Template:
    os_name: windows2019
    template_build_name: 'Win2019-Pre-Template-Base'
    template_build_description: 'Windows 2019 Build - Base Image - CIS Level 1 - Pre-Template - VMware'
    part: 1
  Windows2019_Completed_Template:
    os_name: windows2019
    template_build_name: 'Win2019-Template-Base'
    template_build_description: 'Windows 2019 Build - Base Image - CIS Level 1 - VMware'
    part: 2
    prior_template: 'Win2019-Pre-Template-Base'

# Vaulted Passwords
vaulted_scott_password: <redacted inline encrypted password with ansible-vault>
vaulted_console_password: <redacted inline encrypted password with ansible-vault>
vaulted_grub_password: <redacted inline encrypted password with ansible-vault>

# Following Sections are used by the Kickstart Configuration File Jinja Templates
# to create those files when they are rendered.

# Linux Software Package
#
# List has common will be installed on all version of linux and supplements the packages installed by `@Core` and `@Base`.

packages:
  common:
    - "-dracut-config-rescue"
    - "-ntpdate"
    - "acpid"
    - "aide"
    - "chkconfig"
    - "dmidecode"
    - "findutils"
    - "gzip"
    - "less"
    - "man-pages.noarch"
    - "perl"
    - "sed"
    - "sysfsutils"
    - "tmpwatch"
    - "yp-tools"
    - "ypbind"
  rhel7:
    - "Require @Base"
    - "@Base"
    - "@core"
    - "@console-internet"
    - "screen"
  rhel8:
    - "@Base"
    - "@core"

# Linux Services List
#
# This service will be enable or disable via the kickstart configuration file in the %post section during the loading of the OS.

services:
  rhel7:
    enabled:
      - chronyd
      - sshd
      - ypbind
    disabled:
      - iptables
      - ip6tables
      - yum-updatesd
      - haldaemon
      - mcstrans
      - sysstat
  rhel8:
    enabled:
      - chronyd
      - sshd
      - ypbind
    disabled:
      - iptables
      - ip6tables
      - yum-updatesd
      - haldaemon
      - mcstrans
      - sysstat

# Partition Tables
#
# The hardened section will be called by a role to set the partition in a hardened state when the image is rebooted for the very last time. This is role is only updated /etc/fstab.
#
# The partition tables are used create separate partition on the root disk and setup
# the mounts under LVM2. This method will work for secondary disk as well if
# they are needed.

partition_tables:
  hardened:
    - name: /tmp
      src: /dev/mapper/rootvg-lv_tmp
      fstype: xfs
      options: 'defaults,nodev,noexec,nosuid'
      boot: true
      passno: 0
      state: present
    - name: /var/tmp
      src: /dev/mapper/rootvg-lv_var_tmp
      fstype: xfs
      options: 'defaults,nodev,noexec,nosuid'
      boot: true
      passno: 0
      state: present
    - name: /var
      src: /dev/mapper/rootvg-lv_var
      fstype: xfs
      options: 'defaults,nodev'
      boot: true
      passno: 0
      state: present
    - name: /home
      src: /dev/mapper/rootvg-lv_home
      fstype: xfs
      options: 'defaults,nodev'
      boot: true
      passno: 0
      state: present
  rhel7:
    - part pv.253 --fstype="lvmpv" --ondisk=sda --size=67583
    - part /boot  --fstype="xfs"   --ondisk=sda --size=2048
    - volgroup rootvg --pesize=4096 pv.253
    - logvol /var/tmp --fstype="xfs"  --size=4096  --name=var_tmp --vgname=rootvg --name=lv_var_tmp
    - logvol /var     --fstype="xfs"  --size=16384 --name=var     --vgname=rootvg --name=lv_var
    - logvol swap     --fstype="swap" --size=8192  --name=swap    --vgname=rootvg --name=lv_swap
    - logvol /        --fstype="xfs"  --size=22517 --name=root    --vgname=rootvg --name=lv_root
    - logvol /home    --fstype="xfs"  --size=8192  --name=home    --vgname=rootvg --name=lv_home
    - logvol /tmp     --fstype="xfs"  --size=8192  --name=tmp     --vgname=rootvg --name=lv_tmp
  rhel8:
    - part pv.253 --fstype="lvmpv" --ondisk=sda --size=59391
    - part /boot  --fstype="xfs"   --ondisk=sda --size=2048
    - volgroup rootvg --pesize=4096 pv.253
    - logvol /var/tmp --fstype="xfs"  --size=4096  --name=var_tmp --vgname=rootvg --name=lv_var_tmp
    - logvol /var     --fstype="xfs"  --size=8192  --name=var     --vgname=rootvg --name=lv_var
    - logvol swap     --fstype="swap" --size=8192  --name=swap    --vgname=rootvg --name=lv_swap
    - logvol /        --fstype="xfs"  --size=22517 --name=root    --vgname=rootvg --name=lv_root
    - logvol /home    --fstype="xfs"  --size=8192  --name=home    --vgname=rootvg --name=lv_home
    - logvol /tmp     --fstype="xfs"  --size=8192  --name=tmp     --vgname=rootvg --name=lv_tmp

# Network List
#
# The nameservers section will setup up the common DNS servers that available to
# all the images during the build.
#
# The OSes section will assign the IP Address to the images during the build so
# ssh can be used to build them out with Ansible.
#
# This IP Address ideally are on a build subnet.

network:
  nameservers: 10.10.10.10,10.10.10.11
  rhel7:
    ip: 10.10.100.100
    gateway: 10.10.100.1
    netmask: 255.255.255.0
  rhel8:
    ip: 10.10.100.101
    gateway: 10.10.100.1
    netmask: 255.255.255.0
  windows2019:
    ip: 10.10.1008.102
    gateway: 10.10.100.1
    cidr: 24

# Used by Packer to tell the builder what drive letter to use the secondard ISO and mount it
# that drive letter, so the Auto Untended file can be used.

win_autounattend:
  drive: 'f:'

# Source Variables in HCL file
#
# Following Sections are used by the Packer HCL Configuration Files Jinja Templates
# to create those files when they are rendered.

packer_os_builds:
  rhel7:
    packer:
      iso_path_storage: "<Name of Datastore with OS ISOs>"
      iso_path: "ISO/rhel-server-7.9-x86_64-dvd.iso"
      iso_ks_path: "ISO/ks_vmware_rhel7.cfg"
      ks_cfg: ks_vmware_rhel7.cfg
      ks_cfg_template: ks_vmware_rhel7.cfg.j2
      pkr_cfg: vsphere-vmware-rhel7.pkr.hcl
      pkr_cfg_template: vsphere-vmware-rhel7.pkr.hcl.j2
      os_guest_type: rhel7_64Guest
      vm_cpu_num: 2
      mem_size: 4096
      ram_reserve_all: false
      disk_size: 69632
      disk_thin_provisioned: true
      network_card: vmxnet3
      disk_controller_type: pvscsi
      provisioner_source: rhel7-builder
      provisioner_sources: sources.vsphere-iso.rhel7-builder
      provisioner_iso: vsphere-iso
    kickstart:
      timezone: America/Denver
      selinux: "--permissive"
      auth_options: '--enableshadow --passalgo=sha512'
      passalgo: sha512
  rhel8:
    packer:
      iso_path_storage: "<Name of Datastore with OS ISOs>"
      iso_path: "ISO/rhel-8.7-x86_64-dvd.iso"
      iso_ks_path: "ISO/ks_vmware_rhel8.cfg"
      ks_cfg: ks_onprem_rhel8.cfg
      ks_cfg_template: ks_vmware_rhel8.cfg.j2
      pkr_cfg: vsphere-vmware-rhel8.pkr.hcl
      pkr_cfg_template: vsphere-vmware-rhel8.pkr.hcl.j2
      os_guest_type: rhel8_64Guest
      vm_cpu_num: 2
      mem_size: 4096
      ram_reserve_all: false
      disk_size: 69632
      disk_thin_provisioned: true
      network_card: vmxnet3
      disk_controller_type: pvscsi
      provisioner_source: rhel8-builder
      provisioner_sources: sources.vsphere-iso.rhel8-builder
      provisioner_iso: vsphere-iso
    kickstart:
      timezone: America/Denver
      selinux: "--permissive"
  windows2019:
    packer:
      iso_path_storage: "<Name of Datastore with OS ISOs>"
      iso_path: "ISO/windows2019.iso"
      pkr_part1_cfg: windows-server-2019-part1.pkr.hcl
      pkr_part1_cfg_template: windows-server-2019-part1.pkr.hcl.j2
      pkr_part2_cfg: windows-server-2019-part2.pkr.hcl
      pkr_part2_cfg_template: windows-server-2019-part2.pkr.hcl.j2
      win_cfg: autounattend.xml
      win_cfg_template: autounattend.xml.2019.j2
      os_guest_type: windows9Server64Guest
      vm_cpu_num: 2
      mem_size: 4096
      ram_reserve_all: true
      disk_size: 40960
      disk_thin_provisioned: true
      network_card: vmxnet3
      disk_controller_type: lsilogic-sas
      provisioner_source: windows2019-builder
      provisioner_iso_sources: sources.vsphere-iso.windows2019-builder
      provisioner_clone_sources: sources.vsphere-clone.windows2019-builder
      provisioner_iso: vsphere-iso
      provisioner_clone: vsphere-clone
    execenv_iso_path: '{{ working_dir_path }}/windows2019'
    execenv_scripts_path: '{{ working_dir_path }}/windows2019/scripts'
    execenv_answer_files: '{{ working_dir_path }}/windows2019/answer_files'
    template_scripts_path: scripts
    scripts:
      - disable-network-discovery.cmd
      - enable-rdp.cmd
      - install-vm-tools.cmd
      - set-temp.ps1
      - winrm-ansible.ps1

...

----
<1> Packer will show information in color but when executing it from AAP, those color codes will not render correctly and really makes a mess in the Job Log.

=== File: `00-shared-linux.yml``

.00-shared-linux.yml.
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
# Variables for Linux Servers

ansible_remote_tmp: $HOME/.ansible/tmp <1>

...

----
<1> After the partitions are hardened, one parameter call `noexec` will keep Ansible from running on the new image, so a new path for executing Ansible will need to be provided.

=== File: `00-shared-windows.yml``

.00-shared-windows.yml.
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
# Variable for Windows Servers

# Windows Connections <1>

ansible_connection: winrm
ansible_winrm_server_cert_validation: ignore
ansible_winrm_transport: ntlm
ansible_port: 5986
#ansible_winrm_operation_timeout_sec: 200
#ansible_winrm_read_timeout_sec: 250

# Windows Updates Variables <2>

windows_update_category_names:
  - CriticalUpdates
  - SecurityUpdates
  - UpdateRollups

#windows_update_reject_list: ''

windows_update_reboot: true <3>
windows_update_reboot_timeout: 3600 <4>
wu_log_path: 'c:\wu_updates.log' <5>

...

----
<1> Provide Ansible with a method of connecting to Windows to execute Ansible playbooks and roles.
<2> After the OS is built, Windows is patch using the categories listed.
<3> Determine whether to reboot Windows after patching or not.
<4> How long to wait for the reboot to complete and return access to Windows for Ansible to continue.
<5> Where to log the patching activities.

=== File: `inventory`

This file is used by Inventory Sources, that has been set to `Sourced from a Project`. The inventory variables are upload to the controller as a Git repository via a Project.  Once the project is synced then a Inventory Source can be create, using `inventory` as `Inventory File` setting.

.inventory.
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
[linux]

[windows]

[win2019]
----

=== File: `00-rhel7-cis.yml`

This inventory file is used by the role `RHEL7-CIS` which is from `https://github.com/ansible-lockdown/RHEL7-CIS`. There are variable in this file that need to configured so Ansible and Packer is able to build the RHEL 7 image. Some of the rule were disabled to keep the Image from stopping Ansible from completing it's build. When the image is actually use, the role will need to executed again, with those rules enabled as the last role after all the connection to LDAP, application are installed, etc.

.00-rhel7-cis.yml.
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
# rhel7cis_notauto will auto install intrusive items
rhel7cis_notauto: false

# Disable/Enable whole sections (Default is for all)
rhel7cis_section1: true
rhel7cis_section2: true
rhel7cis_section3: true
rhel7cis_section4: true
rhel7cis_section5: true
rhel7cis_section6: true

# Disable/Enable OS check
rhel7cis_os_check: true

# Should always reboot after this number of changes allow this to be automated as part of remediation
skip_reboot: true
change_requires_reboot: false

## Python Binary
## This is used for python3 Installations where python2 OS modules are used in ansible
python2_bin: /bin/python2.7


## Benchmark name used by audting control role
# The audit variable found at the base
benchmark: RHEL7-CIS

#### Basic external goss audit enablement settings ####
#### Precise details - per setting can be found at the bottom of this file ####

### Goss is required on the remote host
setup_audit: false
# How to retrive goss
# Options are copy or download - detailed settings at the bottom of this file
# you will need to access to either github or the file already dowmloaded
get_goss_file: download

# how to get audit files onto host options
# options are git/copy/get_url
audit_content: git

# Timeout for those cmds that take longer to run where timeout set
audit_cmd_timeout: 30000

# enable audits to run - this  runs the audit and get the latest content
run_audit: false

### End Goss enablements ####
#### Detailed settings found at the end of this document ####


# Enable/Disable SELinux
rhel7cis_selinux_disable: false
rhel7cis_selinux_state: enforcing

system_is_container: false
# Place to find the container yml file for your environment - /vars/... This can be adjusted for your requirements.
container_vars_file: is_container.yml

# Misc. environment variables
rhel7cis_skip_for_travis: false
system_is_ec2: false

# Change to false if using EFI boot changes 1.1.1.4 to stop vfat
rhel7cis_legacy_boot: true

# If set true uses the tmp.mount service else using fstab configuration
rhel7cis_tmp_svc: false

# These variables correspond with the CIS rule IDs or paragraph numbers defined in
# the CIS benchmark documents.
# PLEASE NOTE: These work in coordination with the section # group variables and tags.
# You must enable an entire section in order for the variables below to take effect.
# Section 1 rules
# Section 1 is Initial Setup (Filesystem Configuration, Configure Software Updates, Configure Sudo, Filesystem Integrity Checking, Secure Boot Settings, Additional Process Hardening, Mandatory Access Control, and Warning Banners)
rhel7cis_rule_1_1_1_1: true
rhel7cis_rule_1_1_1_2: true
rhel7cis_rule_1_1_1_3: true
rhel7cis_rule_1_1_2: true
rhel7cis_rule_1_1_3: true
rhel7cis_rule_1_1_4: true
rhel7cis_rule_1_1_5: true
rhel7cis_rule_1_1_6: true
rhel7cis_rule_1_1_7: true
rhel7cis_rule_1_1_8: true
rhel7cis_rule_1_1_9: true
rhel7cis_rule_1_1_10: true
rhel7cis_rule_1_1_11: true
rhel7cis_rule_1_1_12: true
rhel7cis_rule_1_1_13: true
rhel7cis_rule_1_1_14: true
rhel7cis_rule_1_1_15: true
rhel7cis_rule_1_1_16: true
rhel7cis_rule_1_1_17: true
rhel7cis_rule_1_1_18: true
rhel7cis_rule_1_1_19: true
rhel7cis_rule_1_1_20: true
rhel7cis_rule_1_1_21: true
rhel7cis_rule_1_1_22: true
rhel7cis_rule_1_1_23: true
rhel7cis_rule_1_1_24: true
rhel7cis_rule_1_2_1: true
rhel7cis_rule_1_2_2: true
rhel7cis_rule_1_2_3: true
rhel7cis_rule_1_3_1: true
rhel7cis_rule_1_3_2: true
rhel7cis_rule_1_4_1: true
rhel7cis_rule_1_4_2: true
rhel7cis_rule_1_4_3: true
rhel7cis_rule_1_5_1: true
rhel7cis_rule_1_5_2: true
rhel7cis_rule_1_5_3: true
rhel7cis_rule_1_5_4: true
rhel7cis_rule_1_6_1_1: true
rhel7cis_rule_1_6_1_2: true
rhel7cis_rule_1_6_1_3: true
rhel7cis_rule_1_6_1_4: true
rhel7cis_rule_1_6_1_5: true
rhel7cis_rule_1_6_1_6: true
rhel7cis_rule_1_6_1_7: true
rhel7cis_rule_1_6_1_8: true
rhel7cis_rule_1_7_1: true
rhel7cis_rule_1_7_2: true
rhel7cis_rule_1_7_3: true
rhel7cis_rule_1_7_4: true
rhel7cis_rule_1_7_5: true
rhel7cis_rule_1_7_6: true
rhel7cis_rule_1_8_1: true
rhel7cis_rule_1_8_2: true
rhel7cis_rule_1_8_3: true
rhel7cis_rule_1_8_4: true
rhel7cis_rule_1_9: true

# Section 2 rules
# Section 2 is Services (inetd Services, Special Purpose Services, and Service Clients)
rhel7cis_rule_2_1_1: true
rhel7cis_rule_2_2_1_1: true
rhel7cis_rule_2_2_1_2: true
rhel7cis_rule_2_2_1_3: true
rhel7cis_rule_2_2_2: true
rhel7cis_rule_2_2_3: true
rhel7cis_rule_2_2_4: true
rhel7cis_rule_2_2_5: true
rhel7cis_rule_2_2_6: true
rhel7cis_rule_2_2_7: true
rhel7cis_rule_2_2_8: true
rhel7cis_rule_2_2_9: true
rhel7cis_rule_2_2_10: true
rhel7cis_rule_2_2_11: true
rhel7cis_rule_2_2_12: true
rhel7cis_rule_2_2_13: true
rhel7cis_rule_2_2_14: true
rhel7cis_rule_2_2_15: true
rhel7cis_rule_2_2_16: true
rhel7cis_rule_2_2_17: true
rhel7cis_rule_2_2_18: true
rhel7cis_rule_2_2_19: true
rhel7cis_rule_2_3_1: true
rhel7cis_rule_2_3_2: true
rhel7cis_rule_2_3_3: true
rhel7cis_rule_2_3_4: true
rhel7cis_rule_2_3_5: true
rhel7cis_rule_2_4: true

# Section 3 rules
# Section 3 is Network Configuration (Disable unused network protocols, Network parameters (host), Network parameters (Host and Router), Uncommon Network Protocols, Firewall Configuration, and Configure iptables)
rhel7cis_rule_3_1_1: true
rhel7cis_rule_3_1_2: true
rhel7cis_rule_3_2_1: true
rhel7cis_rule_3_2_2: true
rhel7cis_rule_3_3_1: true
rhel7cis_rule_3_3_2: true
rhel7cis_rule_3_3_3: true
rhel7cis_rule_3_3_4: true
rhel7cis_rule_3_3_5: true
rhel7cis_rule_3_3_6: true
rhel7cis_rule_3_3_7: true
rhel7cis_rule_3_3_8: true
rhel7cis_rule_3_3_9: true
rhel7cis_rule_3_4_1: true
rhel7cis_rule_3_4_2: true
rhel7cis_rule_3_5_1_1: true
rhel7cis_rule_3_5_1_2: true
rhel7cis_rule_3_5_1_3: true
rhel7cis_rule_3_5_1_4: true
rhel7cis_rule_3_5_1_5: true
rhel7cis_rule_3_5_1_6: true
rhel7cis_rule_3_5_1_7: true
rhel7cis_rule_3_5_2_1: true
rhel7cis_rule_3_5_2_2: true
rhel7cis_rule_3_5_2_3: true
rhel7cis_rule_3_5_2_4: true
rhel7cis_rule_3_5_2_5: true
rhel7cis_rule_3_5_2_6: true
rhel7cis_rule_3_5_2_7: true
rhel7cis_rule_3_5_2_8: true
rhel7cis_rule_3_5_2_9: true
rhel7cis_rule_3_5_2_10: true
rhel7cis_rule_3_5_2_11: true
rhel7cis_rule_3_5_3_1_1: true
rhel7cis_rule_3_5_3_1_2: true
rhel7cis_rule_3_5_3_1_3: true
rhel7cis_rule_3_5_3_2_1: true
rhel7cis_rule_3_5_3_2_2: true
rhel7cis_rule_3_5_3_2_3: true
rhel7cis_rule_3_5_3_2_4: true
rhel7cis_rule_3_5_3_2_5: true
rhel7cis_rule_3_5_3_2_6: true
rhel7cis_rule_3_5_3_3_1: true
rhel7cis_rule_3_5_3_3_2: true
rhel7cis_rule_3_5_3_3_3: true
rhel7cis_rule_3_5_3_3_4: true
rhel7cis_rule_3_5_3_3_5: true
rhel7cis_rule_3_5_3_3_6: true

# Section 4 rules
# Section 4 is Logging and Auditing (Configure System Accounting (auditd) and Configure Logging)
rhel7cis_rule_4_1_1_1: true
rhel7cis_rule_4_1_1_2: true
rhel7cis_rule_4_1_1_3: true
rhel7cis_rule_4_1_2_1: true
rhel7cis_rule_4_1_2_2: true
rhel7cis_rule_4_1_2_3: true
rhel7cis_rule_4_1_2_4: true
rhel7cis_rule_4_1_3: true
rhel7cis_rule_4_1_4: true
rhel7cis_rule_4_1_5: true
rhel7cis_rule_4_1_6: true
rhel7cis_rule_4_1_7: true
rhel7cis_rule_4_1_8: true
rhel7cis_rule_4_1_9: true
rhel7cis_rule_4_1_10: true
rhel7cis_rule_4_1_11: true
rhel7cis_rule_4_1_12: true
rhel7cis_rule_4_1_13: true
rhel7cis_rule_4_1_14: true
rhel7cis_rule_4_1_15: true
rhel7cis_rule_4_1_16: true
rhel7cis_rule_4_1_17: true
rhel7cis_rule_4_2_1_1: true
rhel7cis_rule_4_2_1_2: true
rhel7cis_rule_4_2_1_3: true
rhel7cis_rule_4_2_1_4: true
rhel7cis_rule_4_2_1_5: true
rhel7cis_rule_4_2_1_6: true
rhel7cis_rule_4_2_2_1: true
rhel7cis_rule_4_2_2_2: true
rhel7cis_rule_4_2_2_3: true
rhel7cis_rule_4_2_3: true
rhel7cis_rule_4_2_4: true

# Section 5 rules
# Section 5 is Access, Authentication, and Authorization (Configure time-based job schedulers, Configure SSH Server, Configure PAM, and User Accounts and Environment)
rhel7cis_rule_5_1_1: true
rhel7cis_rule_5_1_2: true
rhel7cis_rule_5_1_3: true
rhel7cis_rule_5_1_4: true
rhel7cis_rule_5_1_5: true
rhel7cis_rule_5_1_6: true
rhel7cis_rule_5_1_7: true
rhel7cis_rule_5_1_8: true
rhel7cis_rule_5_1_9: true
rhel7cis_rule_5_2_1: true
rhel7cis_rule_5_2_2: true
rhel7cis_rule_5_2_3: true
rhel7cis_rule_5_3_1: true
rhel7cis_rule_5_3_2: true
rhel7cis_rule_5_3_3: true
rhel7cis_rule_5_3_4: true
rhel7cis_rule_5_3_5: true
rhel7cis_rule_5_3_6: true
rhel7cis_rule_5_3_7: true
rhel7cis_rule_5_3_8: true
rhel7cis_rule_5_3_9: true
rhel7cis_rule_5_3_10: true
rhel7cis_rule_5_3_12: true
rhel7cis_rule_5_3_11: true
rhel7cis_rule_5_3_13: true
rhel7cis_rule_5_3_14: true
rhel7cis_rule_5_3_15: true
rhel7cis_rule_5_3_16: true
rhel7cis_rule_5_3_17: true
rhel7cis_rule_5_3_18: true
rhel7cis_rule_5_3_19: true
rhel7cis_rule_5_3_20: true
rhel7cis_rule_5_3_21: true
rhel7cis_rule_5_3_22: true
rhel7cis_rule_5_4_1: true
rhel7cis_rule_5_4_2: true
rhel7cis_rule_5_4_3: true
rhel7cis_rule_5_4_4: true
rhel7cis_rule_5_5_1_1: true
rhel7cis_rule_5_5_1_2: true
rhel7cis_rule_5_5_1_3: true
rhel7cis_rule_5_5_1_4: true
rhel7cis_rule_5_5_1_5: true
rhel7cis_rule_5_5_2: false <1>
rhel7cis_rule_5_5_3: true
rhel7cis_rule_5_5_4: true
rhel7cis_rule_5_5_5: true
rhel7cis_rule_5_6: true
rhel7cis_rule_5_7: true
# Section 6 rules
# Section 6 is System Maintenance (System File Permissions and User and Group Settings)
rhel7cis_rule_6_1_1: true
rhel7cis_rule_6_1_2: true
rhel7cis_rule_6_1_3: true
rhel7cis_rule_6_1_4: true
rhel7cis_rule_6_1_5: true
rhel7cis_rule_6_1_6: true
rhel7cis_rule_6_1_7: true
rhel7cis_rule_6_1_8: true
rhel7cis_rule_6_1_9: true
rhel7cis_rule_6_1_10: true
rhel7cis_rule_6_1_11: true
rhel7cis_rule_6_1_12: true
rhel7cis_rule_6_1_13: true
rhel7cis_rule_6_1_14: true
rhel7cis_rule_6_2_1: true
rhel7cis_rule_6_2_2: true
rhel7cis_rule_6_2_3: true
rhel7cis_rule_6_2_4: true
rhel7cis_rule_6_2_5: true
rhel7cis_rule_6_2_6: true
rhel7cis_rule_6_2_7: true
rhel7cis_rule_6_2_8: true
rhel7cis_rule_6_2_9: true
rhel7cis_rule_6_2_10: true
rhel7cis_rule_6_2_11: true
rhel7cis_rule_6_2_12: true
rhel7cis_rule_6_2_13: true
rhel7cis_rule_6_2_14: true
rhel7cis_rule_6_2_15: true
rhel7cis_rule_6_2_16: true
rhel7cis_rule_6_2_17: true

# Service configuration booleans set true to keep service
rhel7cis_avahi_server: false
rhel7cis_cups_server: false
rhel7cis_dhcp_server: false
rhel7cis_ldap_server: false
rhel7cis_telnet_server: false
rhel7cis_nfs_server: false
rhel7cis_rpc_server: false
rhel7cis_ntalk_server: false
rhel7cis_rsyncd_server: false
rhel7cis_tftp_server: false
rhel7cis_rsh_server: false
rhel7cis_nis_server: false
rhel7cis_snmp_server: false
rhel7cis_squid_server: false
rhel7cis_smb_server: false
rhel7cis_dovecot_server: false
rhel7cis_httpd_server: false
rhel7cis_vsftpd_server: false
rhel7cis_named_server: false
rhel7cis_nfs_rpc_server: false
rhel7cis_is_mail_server: false
rhel7cis_bind: false
rhel7cis_vsftpd: false
rhel7cis_httpd: false
rhel7cis_dovecot: false
rhel7cis_samba: false
rhel7cis_squid: false
rhel7cis_net_snmp: false
rhel7cis_allow_autofs: false

## Section 1 vars
# 1.3.3 var log location variable
rhel7cis_varlog_location: "/var/log/sudo.log"

# xinetd required
rhel7cis_xinetd_required: false

# RedHat Satellite Subscription items
rhel7cis_rhnsd_required: false

# 1.4.2 Bootloader password
rhel7cis_set_boot_pass: false
rhel7cis_bootloader_password_hash: 'grub.pbkdf2.sha512.changethispart'

# System network parameters (host only OR host and router)
rhel7cis_is_router: false

# IPv6 required
rhel7cis_ipv6_required: true

# AIDE
rhel7cis_config_aide: true
# AIDE cron settings
rhel7cis_aide_cron:
    cron_user: root
    cron_file: /etc/cron.d/cis_aide
    aide_job: '/usr/sbin/aide --check'
    aide_minute: '0'
    aide_hour: '5'
    aide_day: '*'
    aide_month: '*'
    aide_weekday: '*'

# SELinux policy
rhel7cis_selinux_pol: targeted

# Whether or not to run tasks related to auditing/patching the desktop environment
rhel7cis_gui: false

# Set to 'true' if X Windows is needed in your environment
rhel7cis_xwindows_required: false

rhel7cis_openldap_clients_required: false
rhel7cis_telnet_required: false
rhel7cis_talk_required: false
rhel7cis_rsh_required: false
rhel7cis_ypbind_required: false

# Time Synchronization - Either chrony or ntp
rhel7cis_time_synchronization: chrony

rhel7cis_time_synchronization_servers:
    - 0.pool.ntp.org
    - 1.pool.ntp.org
    - 2.pool.ntp.org
    - 3.pool.ntp.org

rhel7cis_chrony_server_options: "minpoll 8"
rhel7cis_ntp_server_options: "iburst"

# 3.4.2 | PATCH | Ensure /etc/hosts.allow is configured
rhel7cis_host_allow:
    - "10.0.0.0/255.0.0.0"
    - "172.16.0.0/255.240.0.0"
    - "192.168.0.0/255.255.0.0"

# Firewall Service - either firewalld or iptables
rhel7cis_firewall: firewalld
rhel7cis_default_zone: public

rhel7cis_firewall_services:
    - ssh
    - dhcpv6-client

# 3.5.2.x
# NFT firewall
# not tested but added example for clarity - This will break connections
# If the tables dont exist automatically create the tablename below
rhel7cis_nft_tables_autoNewTable: false
# create chain if doesnt exist
rhel7cis_nft_tables_autoChainCreate: false
# create a table called
rhel7cis_nft_tables_tableName: filter

# 3.5.3.x.x iptables
rhel7cis_save_iptables_cis_rules: true
rhel7cis_save_ip6tables_cis_rules: true
# rhel7cis_firewall: iptables
rhel7cis_iptables_boot_config: /etc/sysconfig/iptables
rhel7cis_ip6tables_boot_config: /etc/sysconfig/ip6tables

# Warning Banner Content (issue, issue.net, motd)
rhel7cis_warning_banner: |
    You are about to access a private system. Unauthorized access to, or use of, this system is strictly prohibited.
    Unauthorized access to, or misuse of, any data on this system is also strictly prohibited. All attempts to access
    this system, whether successful or not, are monitored and recorded. You should have no expectation of privacy
    when using this system. By continuing, you agree to these conditions, unauthorized use may be subject to
    discipline and applicable law.
# End Banner

## Section4 vars

# auditd settings
rhel7cis_auditd:
    space_left_action: email
    action_mail_acct: root
    admin_space_left_action: halt
    max_log_file_action: keep_logs

rhel7cis_logrotate: "daily"

# RHEL-07-4.1.2.4
# rhel7cis_audit_backlog_limit value needs to be 8192 or larger to conform to CIS standards
rhel7cis_audit_backlog_limit: 8192

# RHEL-07-4.2.1.4/4.2.1.5 remote and destation log server name
rhel7cis_remote_log_server: logagg.example.com

# RHEL-07-4.2.1.5
rhel7cis_system_is_log_server: false

## Section5 vars

# SSH variables
rhel7cis_ssh_loglevel: INFO
rhel7cis_ssh_maxsessions: 10
rhel7cis_sshd:
    clientalivecountmax: 3
    clientaliveinterval: 300
    ciphers: "aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr"
    macs: "hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256"
    kex: "diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256"
    logingracetime: 60
    # WARNING: make sure you understand the precedence when working with these values!!
    # allowusers:
    # allowgroups: systems dba
    # denyusers:
    # denygroups:

# pam variables
rhel7cis_pam_faillock:
    attempts: 5
    interval: 900
    unlock_time: 900
    fail_for_root: no  # noqa yaml[truthy]
    remember: 5
    pwhash: sha512
rhel7cis_inactivelock:
    lock_days: 30

# Accounte listed below will not have INACTIVE field set in shadow file
rhel7cis_inactive_whitelist:
    - root
    - vagrant

rhel7cis_pass:
    max_days: 90
    min_days: 7
    warn_age: 7
# Syslog system - either rsyslog or syslog-ng
rhel7cis_syslog: rsyslog
rhel7cis_rsyslog_ansiblemanaged: true

# Var/tmp settings
rhel7cis_vartmp:
    source: /tmp
    fstype: none
    opts: "defaults,nodev,nosuid,noexec,bind"
    enabled: true

# Interactive user UID starting point
rhel7cis_rule_5_4_2_min_uid: 1000

# RHEL-07-5.4.5
# Session timeout setting file (TMOUT setting can be set in multiple files)
# Timeout value is in seconds. (60 seconds * 10 = 600)
rhel7cis_shell_session_timeout:
    file: /etc/profile.d/tmout.sh
    timeout: 600
# RHEL-07-5.4.1.5 Allow ansible to expire password for account with a last changed date in the future. False will just display users in violation, true will expire those users passwords
rhel7cis_futurepwchgdate_autofix: true

# 5.4.2
rhel7cis_int_gid: 1000

# 5.6 Group to be used for su
# this group needs to exists groups will not be created for remediation this is considered sys admins

# rhel7cis_sugroup: sugroup

## Section6 vars

# RHEL-07_6.1.1
rhel7cis_rpm_audit_file: /var/tmp/rpm_file_check

# RHEL-07_6.1.10 Allow ansible to adjust world-writable files. False will just display world-writable files, True will remove world-writable
rhel7cis_no_world_write_adjust: true
rhel7cis_passwd_label: "{{ (this_item | default(item)).id }}: {{ (this_item | default(item)).dir }}"
rhel7cis_dotperm_ansiblemanaged: true

# RHEL-07-6.2.18 Clear users from shadow group
rhel7cis_remove_shadow_grp_usrs: true

#### Goss Configuration Settings ####
audit_run_script_environment:
    AUDIT_BIN: "{{ audit_bin }}"
    AUDIT_FILE: 'goss.yml'
    AUDIT_CONTENT_LOCATION: "{{ audit_out_dir }}"

### Goss binary settings ###
goss_version:
    release: v0.3.16
    checksum: 'sha256:827e354b48f93bce933f5efcd1f00dc82569c42a179cf2d384b040d8a80bfbfb'
audit_bin_path: /usr/local/bin/
audit_bin: "{{ audit_bin_path }}goss"
audit_format: json

# if get_goss_file == download change accordingly
goss_url: "https://github.com/aelsabbahy/goss/releases/download/{{ goss_version.release }}/goss-linux-amd64"

## if get_goss_file - copy the following needs to be updated for your environment
## it is expected that it will be copied from somewhere accessible to the control node
## e.g copy from ansible control node to remote host
copy_goss_from_path: /some/accessible/path

### Goss Audit Benchmark file ###
## managed by the control audit_content
# git
audit_file_git: "https://github.com/ansible-lockdown/{{ benchmark }}-Audit.git"
audit_git_version: main

# copy:
audit_local_copy: "some path to copy from"

# get_url:
audit_files_url: "some url maybe s3?"

# Where the goss audit configuration will be stored
audit_files: "/opt/{{ benchmark }}-Audit/"

## Goss configuration information
# Where the goss configs and outputs are stored
audit_out_dir: '/opt'
audit_conf_dir: "{{ audit_out_dir }}/{{ benchmark }}-Audit/"
pre_audit_outfile: "{{ audit_out_dir }}/{{ ansible_hostname }}-{{ benchmark }}_pre_scan_{{ ansible_date_time.epoch }}.{{ audit_format }}"
post_audit_outfile: "{{ audit_out_dir }}/{{ ansible_hostname }}-{{ benchmark }}_post_scan_{{ ansible_date_time.epoch }}.{{ audit_format }}"

## The following should not need changing
goss_file: "{{ audit_conf_dir }}goss.yml"
audit_vars_path: "{{ audit_conf_dir  }}/vars/{{ ansible_hostname }}.yml"
audit_results: |
      The pre remediation results are: {{ pre_audit_summary }}.
      The post remediation results are: {{ post_audit_summary }}.
      Full breakdown can be found in {{ audit_out_dir }}

...

----

=== File: `00-rhel8-cis.yml`

his inventory file is used by the role `RHEL8-CIS` which is from `https://github.com/ansible-lockdown/RHEL8-CIS`. There are variable in this file that need to configured so Ansible and Packer is able to build the RHEL 8 image. Some of the rule were disabled to keep the Image from stopping Ansible from completing it's build. When the image is actually use, the role will need to executed again, with those rules enabled as the last role after all the connection to LDAP, application are installed, etc.

.00-rhel8-cis.yml.
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
# defaults file for rhel8-cis

rhel8cis_skip_for_travis: false
system_is_container: false
# Place to find the container yml file for your environment - /vars/... This can be adjusted for your requirements.
container_vars_file: is_container.yml

os_check: true
# rhel8cis is left off the front of this var for consistency in testing pipeline
# system_is_ec2 toggle will disable tasks that fail on Amazon EC2 instances. Set true to skip and false to run tasks
system_is_ec2: false

rhel8cis_notauto: false
rhel8cis_section1: true
rhel8cis_section2: true
rhel8cis_section3: true
rhel8cis_section4: true
rhel8cis_section5: true
rhel8cis_section6: true

rhel8cis_level_1: true
rhel8cis_level_2: false

rhel8cis_selinux_disable: false
rhel8cis_legacy_boot: false

## Python Binary
## This is used for python3 Installations where python2 OS modules are used in ansible
python2_bin: /bin/python2.7

## Benchmark name used by audting control role
# The audit variable found at the base
benchmark: RHEL8-CIS

# Whether to skip the reboot
skip_reboot: true

#### Basic external goss audit enablement settings ####
#### Precise details - per setting can be found at the bottom of this file ####

### Goss is required on the remote host
setup_audit: false
# How to retrive goss
# Options are copy or download - detailed settings at the bottom of this file
# you will need to access to either github or the file already dowmloaded
get_goss_file: download

# how to get audit files onto host options
# options are git/copy/get_url - use local if already available to to the host (adjust paths accordingly)
audit_content: git

# enable audits to run - this  runs the audit and get the latest content
run_audit: false

# Timeout for those cmds that take longer to run where timeout set
audit_cmd_timeout: 30000

### End Goss enablements ####
#### Detailed settings found at the end of this document ####

# These variables correspond with the CIS rule IDs or paragraph numbers defined in
# the CIS benchmark documents.
# PLEASE NOTE: These work in coordination with the section # group variables and tags.
# You must enable an entire section in order for the variables below to take effect.
# Section 1 rules
rhel8cis_rule_1_1_1_1: true
rhel8cis_rule_1_1_1_2: true
rhel8cis_rule_1_1_1_3: true
rhel8cis_rule_1_1_2_1: true
rhel8cis_rule_1_1_2_2: true
rhel8cis_rule_1_1_2_3: true
rhel8cis_rule_1_1_2_4: true
rhel8cis_rule_1_1_3_1: true
rhel8cis_rule_1_1_3_2: true
rhel8cis_rule_1_1_3_3: true
rhel8cis_rule_1_1_3_4: true
rhel8cis_rule_1_1_4_1: true
rhel8cis_rule_1_1_4_2: true
rhel8cis_rule_1_1_4_3: true
rhel8cis_rule_1_1_4_4: true
rhel8cis_rule_1_1_5_1: true
rhel8cis_rule_1_1_5_2: true
rhel8cis_rule_1_1_5_3: true
rhel8cis_rule_1_1_5_4: true
rhel8cis_rule_1_1_6_1: true
rhel8cis_rule_1_1_6_2: true
rhel8cis_rule_1_1_6_3: true
rhel8cis_rule_1_1_6_4: true
rhel8cis_rule_1_1_7_1: true
rhel8cis_rule_1_1_7_2: true
rhel8cis_rule_1_1_7_3: true
rhel8cis_rule_1_1_7_4: true
rhel8cis_rule_1_1_7_5: true
rhel8cis_rule_1_1_8_1: true
rhel8cis_rule_1_1_8_2: true
rhel8cis_rule_1_1_8_3: true
rhel8cis_rule_1_1_18: true
rhel8cis_rule_1_1_19: true
rhel8cis_rule_1_1_20: true
rhel8cis_rule_1_1_21: true
rhel8cis_rule_1_1_9: true
rhel8cis_rule_1_1_10: true
rhel8cis_rule_1_2_1: true
rhel8cis_rule_1_2_2: true
rhel8cis_rule_1_2_3: true
rhel8cis_rule_1_2_4: true
rhel8cis_rule_1_3_1: true
rhel8cis_rule_1_3_2: true
rhel8cis_rule_1_4_1: true
rhel8cis_rule_1_4_2: true
rhel8cis_rule_1_4_3: true
rhel8cis_rule_1_5_1: true
rhel8cis_rule_1_5_2: true
rhel8cis_rule_1_5_3: true
rhel8cis_rule_1_6_1: true
rhel8cis_rule_1_6_2: true
rhel8cis_rule_1_6_1_1: true
rhel8cis_rule_1_6_1_2: true
rhel8cis_rule_1_6_1_3: true
rhel8cis_rule_1_6_1_4: true
rhel8cis_rule_1_6_1_5: true
rhel8cis_rule_1_6_1_6: true
rhel8cis_rule_1_6_1_7: true
rhel8cis_rule_1_6_1_8: true
rhel8cis_rule_1_7_1: true
rhel8cis_rule_1_7_2: true
rhel8cis_rule_1_7_3: true
rhel8cis_rule_1_7_4: true
rhel8cis_rule_1_7_5: true
rhel8cis_rule_1_7_6: true
rhel8cis_rule_1_8_1: true
rhel8cis_rule_1_8_2: true
rhel8cis_rule_1_8_3: true
rhel8cis_rule_1_8_4: true
rhel8cis_rule_1_8_5: true
rhel8cis_rule_1_9: true
rhel8cis_rule_1_10: true
rhel8cis_rule_1_11: true

# Section 2 rules
rhel8cis_rule_2_1_1: true
rhel8cis_rule_2_1_2: true
rhel8cis_rule_2_2_1: true
rhel8cis_rule_2_2_2: true
rhel8cis_rule_2_2_3: true
rhel8cis_rule_2_2_4: true
rhel8cis_rule_2_2_5: true
rhel8cis_rule_2_2_6: true
rhel8cis_rule_2_2_7: true
rhel8cis_rule_2_2_8: true
rhel8cis_rule_2_2_9: true
rhel8cis_rule_2_2_10: true
rhel8cis_rule_2_2_11: true
rhel8cis_rule_2_2_12: true
rhel8cis_rule_2_2_13: true
rhel8cis_rule_2_2_14: true
rhel8cis_rule_2_2_15: true
rhel8cis_rule_2_2_16: true
rhel8cis_rule_2_2_17: true
rhel8cis_rule_2_2_18: true
rhel8cis_rule_2_2_19: true
rhel8cis_rule_2_2_20: true
rhel8cis_rule_2_3_1: true
rhel8cis_rule_2_3_2: true
rhel8cis_rule_2_3_3: true
rhel8cis_rule_2_3_4: true
rhel8cis_rule_2_3_5: true
rhel8cis_rule_2_3_6: true
rhel8cis_rule_2_4: true

# Section 3 rules
rhel8cis_rule_3_1_1: true
rhel8cis_rule_3_1_2: true
rhel8cis_rule_3_1_3: true
rhel8cis_rule_3_1_4: true
rhel8cis_rule_3_2_1: true
rhel8cis_rule_3_2_2: true
rhel8cis_rule_3_3_1: true
rhel8cis_rule_3_3_2: true
rhel8cis_rule_3_3_3: true
rhel8cis_rule_3_3_4: true
rhel8cis_rule_3_3_5: true
rhel8cis_rule_3_3_6: true
rhel8cis_rule_3_3_7: true
rhel8cis_rule_3_3_8: true
rhel8cis_rule_3_3_9: true
rhel8cis_rule_3_4_1_1: true
rhel8cis_rule_3_4_1_2: true
rhel8cis_rule_3_4_1_3: true
rhel8cis_rule_3_4_1_4: true
rhel8cis_rule_3_4_1_5: true
rhel8cis_rule_3_4_1_6: true
rhel8cis_rule_3_4_1_7: true
rhel8cis_rule_3_4_2_1: true
rhel8cis_rule_3_4_2_2: true
rhel8cis_rule_3_4_2_3: true
rhel8cis_rule_3_4_2_4: true
rhel8cis_rule_3_4_2_5: true
rhel8cis_rule_3_4_2_6: true
rhel8cis_rule_3_4_2_7: true
rhel8cis_rule_3_4_2_8: true
rhel8cis_rule_3_4_2_9: true
rhel8cis_rule_3_4_2_10: true
rhel8cis_rule_3_4_2_11: true
rhel8cis_rule_3_4_3_1_1: true
rhel8cis_rule_3_4_3_1_2: true
rhel8cis_rule_3_4_3_1_3: true
rhel8cis_rule_3_4_3_2_1: true
rhel8cis_rule_3_4_3_2_2: true
rhel8cis_rule_3_4_3_2_3: true
rhel8cis_rule_3_4_3_2_4: true
rhel8cis_rule_3_4_3_2_5: true
rhel8cis_rule_3_4_3_2_6: true
rhel8cis_rule_3_4_3_3_1: true
rhel8cis_rule_3_4_3_3_2: true
rhel8cis_rule_3_4_3_3_3: true
rhel8cis_rule_3_4_3_3_4: true
rhel8cis_rule_3_4_3_3_5: true
rhel8cis_rule_3_4_3_3_6: true

# Section 4 rules
rhel8cis_rule_4_1_1_1: true
rhel8cis_rule_4_1_1_2: true
rhel8cis_rule_4_1_1_3: true
rhel8cis_rule_4_1_1_4: true
rhel8cis_rule_4_1_2_1: true
rhel8cis_rule_4_1_2_2: true
rhel8cis_rule_4_1_2_3: true
rhel8cis_rule_4_1_3_1: true
rhel8cis_rule_4_1_3_2: true
rhel8cis_rule_4_1_3_3: true
rhel8cis_rule_4_1_3_4: true
rhel8cis_rule_4_1_3_5: true
rhel8cis_rule_4_1_3_6: true
rhel8cis_rule_4_1_3_7: true
rhel8cis_rule_4_1_3_8: true
rhel8cis_rule_4_1_3_9: true
rhel8cis_rule_4_1_3_10: true
rhel8cis_rule_4_1_3_11: true
rhel8cis_rule_4_1_3_12: true
rhel8cis_rule_4_1_3_13: true
rhel8cis_rule_4_1_3_14: true
rhel8cis_rule_4_1_3_15: true
rhel8cis_rule_4_1_3_16: true
rhel8cis_rule_4_1_3_17: true
rhel8cis_rule_4_1_3_18: true
rhel8cis_rule_4_1_3_19: true
rhel8cis_rule_4_1_3_20: true
rhel8cis_rule_4_1_3_21: true
rhel8cis_rule_4_2_1_1: true
rhel8cis_rule_4_2_1_2: true
rhel8cis_rule_4_2_1_3: true
rhel8cis_rule_4_2_1_4: true
rhel8cis_rule_4_2_1_5: true
rhel8cis_rule_4_2_1_6: true
rhel8cis_rule_4_2_1_7: true
rhel8cis_rule_4_2_2_1_1: true
rhel8cis_rule_4_2_2_1_2: true
rhel8cis_rule_4_2_2_1_3: true
rhel8cis_rule_4_2_2_1_4: true
rhel8cis_rule_4_2_2_2: true
rhel8cis_rule_4_2_2_3: true
rhel8cis_rule_4_2_2_4: true
rhel8cis_rule_4_2_2_5: true
rhel8cis_rule_4_2_2_6: true
rhel8cis_rule_4_2_2_7: true
rhel8cis_rule_4_2_3: true
rhel8cis_rule_4_3: true

# Section 5 rules
rhel8cis_rule_5_1_1: true
rhel8cis_rule_5_1_2: true
rhel8cis_rule_5_1_3: true
rhel8cis_rule_5_1_4: true
rhel8cis_rule_5_1_5: true
rhel8cis_rule_5_1_6: true
rhel8cis_rule_5_1_7: true
rhel8cis_rule_5_1_8: true
rhel8cis_rule_5_1_9: true
rhel8cis_rule_5_2_1: true
rhel8cis_rule_5_2_2: true
rhel8cis_rule_5_2_3: true
rhel8cis_rule_5_2_4: true
rhel8cis_rule_5_2_5: true
rhel8cis_rule_5_2_6: true
rhel8cis_rule_5_2_7: true
rhel8cis_rule_5_2_8: true
rhel8cis_rule_5_2_9: true
rhel8cis_rule_5_2_10: true
rhel8cis_rule_5_2_12: true
rhel8cis_rule_5_2_11: true
rhel8cis_rule_5_2_13: true
rhel8cis_rule_5_2_14: true
rhel8cis_rule_5_2_15: true
rhel8cis_rule_5_2_16: true
rhel8cis_rule_5_2_17: true
rhel8cis_rule_5_2_18: true
rhel8cis_rule_5_2_19: true
rhel8cis_rule_5_2_20: true
rhel8cis_rule_5_3_1: true
rhel8cis_rule_5_3_2: true
rhel8cis_rule_5_3_3: true
rhel8cis_rule_5_3_4: false    # Set for Base Image not disable consoleuser from NOPASSWD sudoers usage.
rhel8cis_rule_5_3_5: true
rhel8cis_rule_5_3_6: true
rhel8cis_rule_5_3_7: true
rhel8cis_rule_5_4_1: true
rhel8cis_rule_5_4_2: true
rhel8cis_rule_5_5_1: true
rhel8cis_rule_5_5_2: true
rhel8cis_rule_5_5_3: true
rhel8cis_rule_5_5_4: true
rhel8cis_rule_5_5_5: true
rhel8cis_rule_5_6_1_1: true
rhel8cis_rule_5_6_1_2: true
rhel8cis_rule_5_6_1_3: true
rhel8cis_rule_5_6_1_4: true
rhel8cis_rule_5_6_1_5: true
rhel8cis_rule_5_6_2: true
rhel8cis_rule_5_6_3: true
rhel8cis_rule_5_6_4: true
rhel8cis_rule_5_6_5: true

# Section 6 rules
rhel8cis_rule_6_1_1: true
rhel8cis_rule_6_1_2: true
rhel8cis_rule_6_1_3: true
rhel8cis_rule_6_1_4: true
rhel8cis_rule_6_1_5: true
rhel8cis_rule_6_1_6: true
rhel8cis_rule_6_1_7: true
rhel8cis_rule_6_1_8: true
rhel8cis_rule_6_1_9: true
rhel8cis_rule_6_1_10: true
rhel8cis_rule_6_1_11: true
rhel8cis_rule_6_1_12: true
rhel8cis_rule_6_1_13: true
rhel8cis_rule_6_1_14: true
rhel8cis_rule_6_1_15: true
rhel8cis_rule_6_2_1: true
rhel8cis_rule_6_2_2: true
rhel8cis_rule_6_2_3: true
rhel8cis_rule_6_2_4: true
rhel8cis_rule_6_2_5: true
rhel8cis_rule_6_2_6: true
rhel8cis_rule_6_2_7: true
rhel8cis_rule_6_2_8: false
rhel8cis_rule_6_2_9: true
rhel8cis_rule_6_2_10: true
rhel8cis_rule_6_2_11: true
rhel8cis_rule_6_2_12: true
rhel8cis_rule_6_2_13: true
rhel8cis_rule_6_2_14: true
rhel8cis_rule_6_2_15: true
rhel8cis_rule_6_2_16: true

# Service configuration booleans set true to keep service

# Server Services
rhel8cis_avahi_server: false
rhel8cis_bind: false
rhel8cis_cups_server: false
rhel8cis_dhcp_server: false
rhel8cis_dns_server: false
rhel8cis_dovecot_cyrus_server: false
rhel8cis_ftp_server: false
rhel8cis_httpd_server: false
rhel8cis_is_mail_server: false
rhel8cis_net_snmp_server: false
rhel8cis_nfs_server: false
rhel8cis_nginx_server: false
rhel8cis_nis_server: false
rhel8cis_rpc_server: false
rhel8cis_rsync_server: false
rhel8cis_samba_server: false
rhel8cis_squid_server: false
rhel8cis_telnet_server: false
rhel8cis_tftp_server: false
rhel8cis_vsftpd_server: false
rhel8cis_xinetd_server: false

# Client Services

rhel8cis_ypbind_required: false
rhel8cis_rsh_required: false
rhel8cis_talk_required: false
rhel8cis_telnet_required: false
rhel8cis_openldap_clients_required: false
rhel8cis_tftp_client: false


rhel8cis_allow_autofs: false

## Section 1 vars

# 1.1.2.2
# 1.1.2.3
# 1.1.2.4
# These settings go into the /etc/fstab file for the /tmp mount settings
# The value must contain nosuid,nodev,noexec to conform to CIS standards
# rhel8cis_tmp_tmpfs_settings: "defaults,rw,nosuid,nodev,noexec,relatime 0 0"
# If set true uses the tmp.mount service else using fstab configuration
rhel8cis_tmp_svc: false

# 1.2.1
# This is the login information for your RedHat Subscription
# DO NOT USE PLAIN TEXT PASSWORDS!!!!!
# The intent here is to use a password utility like Ansible Vault here
rhel8cis_rh_sub_user: user
rhel8cis_rh_sub_password: password

# 1.2.2
# Do you require rhnsd
# RedHat Satellite Subscription items
rhel8cis_rhnsd_required: false

# 1.3.3 var log location variable
rhel8cis_varlog_location: "/var/log/sudo.log"

# xinetd required
rhel8cis_xinetd_required: false

# 1.4.1 Bootloader password
rhel8cis_bootloader_password_hash: 'grub.pbkdf2.sha512.changethispassword'
rhel8cis_bootloader_password: random
rhel8cis_set_boot_pass: false

# 1.10/1.11 Set crypto policy (LEGACY, DEFAULT, FUTURE, FIPS)
# Control 1.10 sates not ot use LEGACY and control 1.11 says to use FUTURE or FIPS.
rhel8cis_crypto_policy: "DEFAULT"

# System network parameters (host only OR host and router)
rhel8cis_is_router: false

# IPv6 required
rhel8cis_ipv6_required: true

# AIDE
rhel8cis_config_aide: true
# AIDE cron settings
rhel8cis_aide_cron:
    cron_user: root
    cron_file: /etc/cron.d/cis_aide
    aide_job: '/usr/sbin/aide --check'
    aide_minute: 0
    aide_hour: 5
    aide_day: '*'
    aide_month: '*'
    aide_weekday: '*'

# SELinux policy
rhel8cis_selinux_pol: targeted

# Whether or not to run tasks related to auditing/patching the desktop environment
rhel8cis_gui: false

# Set to 'true' if X Windows is needed in your environment
rhel8cis_xwindows_required: false

# 2.1.1 Time Synchronization - Either chrony or ntp
rhel8cis_time_synchronization: chrony

# 2.2.1.2 Time Synchronization servers - used in template file chrony.conf.j2
rhel8cis_time_synchronization_servers:
    - 0.pool.ntp.org
    - 1.pool.ntp.org
    - 2.pool.ntp.org
    - 3.pool.ntp.org

rhel8cis_chrony_server_options: "minpoll 8"
rhel8cis_ntp_server_options: "iburst"

## Section3 vars
# 3.4.2 | PATCH | Ensure /etc/hosts.allow is configured
rhel8cis_host_allow:
    - "10.0.0.0/255.0.0.0"
    - "172.16.0.0/255.240.0.0"
    - "192.168.0.0/255.255.0.0"

# Firewall Service - either firewalld, iptables, or nftables
rhel8cis_firewall: firewalld

# 3.4.1.5 Default zone setting
rhel8cis_default_zone: public

# 3.4.2.5 Zone and Interface setting
rhel8cis_int_zone: customezone
rhel8cis_interface: eth0

rhel8cis_firewall_services:
    - cockpit
    - dhcpv6-client
    - ssh

# 3.4.2.5 Set nftables new table create
# 3.4.2.6
# 3.4.2.7
# 3.4.2.8
# 3.4.2.9
# 3.4.2.11
rhel8cis_nft_tables_autonewtable: true
rhel8cis_nft_tables_tablename: filter

# 3.4.2.6 Set nftables new chain create
rhel8cis_nft_tables_autochaincreate: true

# Warning Banner Content (issue, issue.net, motd)
rhel8cis_warning_banner: |
    You are about to access a private system. Unauthorized access to, or use of, this system is strictly prohibited.
    Unauthorized access to, or misuse of, any data on this system is also strictly prohibited. All attempts to access
    this system, whether successful or not, are monitored and recorded. You should have no expectation of privacy
    when using this system. By continuing, you agree to these conditions, unauthorized use may be subject to
    discipline and applicable law.
# End Banner

## Section4 vars

update_audit_template: false

rhel8cis_auditd:
    space_left_action: email
    action_mail_acct: root
    admin_space_left_action: halt
    max_log_file_action: keep_logs

# This can be used to configure other keys in auditd.conf
rhel8cis_auditd_extra_conf: {}
# Example:
# rhel8cis_auditd_extra_conf:
#     admin_space_left: '10%'

rhel8cis_logrotate: "daily"

# The audit_back_log_limit value should never be below 8192
rhel8cis_audit_back_log_limit: 8192

# The max_log_file parameter should be based on your sites policy
rhel8cis_max_log_file_size: 10

# OS logging system - either rsyslog or journald or other if 3rd party tool
rhel8cis_syslog: rsyslog
rhel8cis_rsyslog_ansiblemanaged: true

# RHEL-08-4.2.1.4/4.2.1.5 remote and destination log server name
rhel8cis_remote_log_server: logagg.example.com

# 4.2.1.5, 4.2.2.1.3, 4.2.2.1.4
rhel8cis_system_is_log_server: false

# 4.2.2.1.2
# rhel8cis_journal_upload_url is the ip address to upload the journal entries to
rhel8cis_journal_upload_url: 192.168.50.42
# The paths below have the default paths/files, but allow user to create custom paths/filenames
rhel8cis_journal_upload_serverkeyfile: "/etc/ssl/private/journal-upload.pem"
rhel8cis_journal_servercertificatefile: "/etc/ssl/certs/journal-upload.pem"
rhel8cis_journal_trustedcertificatefile: "/etc/ssl/ca/trusted.pem"

# 4.2.2.1
# The variables below related to journald, please set these to your site specific values
# rhel8cis_journald_systemmaxuse is the max amount of disk space the logs will use
rhel8cis_journald_systemmaxuse: 10M
# rhel8cis_journald_systemkeepfree is the amount of disk space to keep free
rhel8cis_journald_systemkeepfree: 100G
rhel8cis_journald_runtimemaxuse: 10M
rhel8cis_journald_runtimekeepfree: 100G
# rhel8cis_journald_MaxFileSec is how long in time to keep log files. Values are Xm, Xh, Xday, Xweek, Xmonth, Xyear, for example 2week is two weeks
rhel8cis_journald_maxfilesec: 1month

# 4.2.3 logrotate configuration
# change to true if you wish to change logrotate.d conf files
allow_logrotate_conf_umask_updates: false

## Section5 vars

rhel8cis_sshd:
    clientalivecountmax: 0
    clientaliveinterval: 900
    logingracetime: 60
    # WARNING: make sure you understand the precedence when working with these values!!
    # allowusers:
    # allowgroups: systems dba
    # denyusers:
    # denygroups:
rhel8cis_pam_faillock:
    attempts: 5
    interval: 900
    unlock_time: 900
    fail_for_root: no  # noqa yaml[truthy]
    remember: 5
    pwhash: sha512

# 5.2.5 SSH LogLevel setting. Options are INFO or VERBOSE
rhel8cis_ssh_loglevel: INFO

# 5.2.19 SSH MaxSessions setting. Must be 10 or less
rhel8cis_ssh_maxsessions: 10


# 5.3.1 Enable automation to create custom profile settings, using the settings above
rhel8cis_authselect_custom_profile_create: false

# 5.3.2 Enable automation to select custom profile options, using the settings above
rhel8cis_authselect_custom_profile_select: false

# 5.3.6 rhel8cis_sudo_timestamp_timeout is the timeout set to authentication in minutes
# To conform to CIS standards this needs to be 15 minutes or less
rhel8cis_sudo_timestamp_timeout: 15

# 5.3.7
# rhel8cis_sugroup: sugroup  # change accordingly wheel is default

# wheel users list
rhel8cis_sugroup_users: "root"

# 5.4.1/5.4.2 Custom authselect profile settings. Settings in place now will fail, they are place holders from the control example
# Due to the way many multiple options and ways to configure this control needs to be enabled and settings adjusted to minimise risk
rhel8cis_use_authconfig: false
rhel8cis_authselect:
    custom_profile_name: custom-profile
    default_file_to_copy: "sssd --symlink-meta"
    options: with-sudo with-faillock without-nullok

# 5.6.1.1
# 5.6.1.2
# 5.6.1.3
rhel8cis_pass:
    max_days: 365
    min_days: 7
    warn_age: 7


# 5.6.1.4
rhel8cis_inactivelock:
    lock_days: 30

# 5.6.1.5 Allow ansible to expire password for account with a last changed date in the future. False will just display users in violation, true will expire those users passwords
rhel8cis_futurepwchgdate_autofix: true

## PAM
rhel8cis_pam_password:
    minlen: 14
    minclass: 4

# This is a dynamic check but can be overridden here marking it as false and uncomment
rhel8uid_info_dynamic: true
# rhel8uid_interactive_uid_start: 1000
# rhel8uid_interactive_uid_stop: 60000

# 5.6.3
# Session timeout setting file (TMOUT setting can be set in multiple files)
# Timeout value is in seconds. (60 seconds * 10 = 600)
rhel8cis_shell_session_timeout:
    file: /etc/profile.d/tmout.sh
    timeout: 600

## Section6 vars

# RHEL-08_6.1.1
rhel8cis_rpm_audit_file: /var/tmp/rpm_file_check

# RHEL-08_6.1.11 Allow ansible to adjust world-writable files. False will just display world-writable files, True will remove world-writable
rhel8cis_no_world_write_adjust: true
rhel8cis_passwd_label: "{{ (this_item | default(item)).id }}: {{ (this_item | default(item)).dir }}"

# 6.2.12
rhel8cis_dotperm_ansiblemanaged: true
#### Goss Configuration Settings ####

### Goss binary settings ###
goss_version:
    release: v0.3.18
    checksum: 'sha256:432308ebca0caf8165d45bd27e3262126aad9d15572ac8cb3149b3c91f75aace'
audit_bin_path: /usr/local/bin/
audit_bin: "{{ audit_bin_path }}goss"
audit_format: json

# if get_goss_file == download change accordingly
goss_url: "https://github.com/aelsabbahy/goss/releases/download/{{ goss_version.release }}/goss-linux-amd64"

## if get_goss_file - copy the following needs to be updated for your environment
## it is expected that it will be copied from somewhere accessible to the control node
## e.g copy from ansible control node to remote host
copy_goss_from_path: /some/accessible/path

### Goss Audit Benchmark file ###
## managed by the control audit_content
# git
audit_file_git: "https://github.com/ansible-lockdown/{{ benchmark }}-Audit.git"
audit_git_version: main

# copy:
audit_local_copy: "some path to copy from"

# get_url:
audit_files_url: "some url maybe s3?"

## Goss configuration information
# Set correct env for the run_audit.sh script from https://github.com/ansible-lockdown/{{ benchmark }}-Audit.git"
audit_run_script_environment:
    AUDIT_BIN: "{{ audit_bin }}"
    AUDIT_FILE: 'goss.yml'
    AUDIT_CONTENT_LOCATION: "{{ audit_out_dir }}"
# Where the goss configs and outputs are stored
audit_out_dir: '/opt'
audit_conf_dir: "{{ audit_out_dir }}/{{ benchmark }}-Audit"
pre_audit_outfile: "{{ audit_out_dir }}/{{ ansible_hostname }}-{{ benchmark }}_pre_scan_{{ ansible_date_time.epoch }}.{{ audit_format }}"
post_audit_outfile: "{{ audit_out_dir }}/{{ ansible_hostname }}-{{ benchmark }}_post_scan_{{ ansible_date_time.epoch }}.{{ audit_format }}"

## The following should not need changing
goss_file: "{{ audit_conf_dir }}goss.yml"
audit_vars_path: "{{ audit_conf_dir }}/vars/{{ ansible_hostname }}.yml"
audit_results: |
      The pre remediation results are: {{ pre_audit_summary }}.
      The post remediation results are: {{ post_audit_summary }}.
      Full breakdown can be found in {{ audit_out_dir }}

...

----

=== File: `00-windows-2019-cis.yml``

.00-windows-2019-cis.yml.
[source,yaml,linenums,options="nowrap",subs="attributes,verbatim"]
----
---
# Variables for CIS Lockdown for Windows 2019 Servers

# Section 1 Account Policies
# 1.1.x Password Policy, 1.2.x Account Lockout Policy
section01_patch: true

# Section 2 Local Policies
# 2.2.x User Rights Assignment, 2.3.x Security Options
section02_patch: true

# Section 5 System Services
# 5.x Printers
section05_patch: true

# Section 9 Windows Defender Firewall with Advanced Security (formerly Windows Firewall with Advanced Security)
# 9.1.x Domain Profile, 9.2.x Private Profile, 9.3.x Public Profile
section09_patch: true

# Section 17 Advanced Audit Policy Configuration
# 17.1.x Account Logon, 17.2.x Account Management, 17.3.x Detailed Tracking, 17.4.x DS Access, 17.5.x Logon/Logoff
# 17.6.x Object Access, 17.7.x Policy Change, 17.8.x Privilege Use, 17.9.x System
section17_patch: true

# Section 18 Administrative Templates (Computer)
# 18.1.x Control Panel, 18.2.x LAPS, 18.3.x MS Security Guide, 18.4.x MSS (Legacy), 18.5.x Network, 18.6.x Printers
# 18.7.x Start Menu and Taskbar, 18.8.x System, 18.9.x Windows Components
section18_patch: true

# Section 19 Administrative Templates (User)
# 19.1.x Control Panel, 19.5.x Start Menu and Taskbar, 19.6.x System, 19.7.x Windows Components
section19_patch: true

min_ansible_version: "2.6"

# We've defined complexity-high to mean that we cannot automatically remediate
# the rule in question.  In the future this might mean that the remediation
# may fail in some cases.
complexity_high: false

# Show "changed" for complex items not remediated per complexity-high setting
# to make them stand out.  "changed" items on a second run of the role would
# indicate items requiring manual review.
audit_complex: true

# We've defined disruption-high to indicate items that are likely to cause
# disruption in a normal workflow.  These items can be remediated automatically
# but are disabled by default to avoid disruption.
disruption_high: false

# Show "changed" for disruptive items not remediated per disruption-high
# setting to make them stand out.
audit_disruptive: true

skip_for_travis: false

workaround_for_disa_benchmark: true
workaround_for_ssg_benchmark: true

# tweak role to run in a non-privileged container
system_is_container: false

# set to false to skip tasks that either have not been developed or cannot be automated
is_implemented: false

# set to false to skip long running tasks
long_running: false

win_skip_for_test: false

# These variables correspond with the STIG IDs defined in the STIG and allows you to enable/disable specific rules.
# PLEASE NOTE: These work in coordination with the cat1, cat2, cat3 group variables. You must enable an entire group
# in order for the variables below to take effect.

# section01
rule_1_1_1: true
rule_1_1_2: true
rule_1_1_3: true
rule_1_1_4: true
rule_1_1_5: true
rule_1_1_6: true
rule_1_2_1: true
rule_1_2_2: true
rule_1_2_3: true

# section02
rule_2_2_1: true
rule_2_2_2: true
rule_2_2_3: true
rule_2_2_4: true
rule_2_2_5: true
rule_2_2_6: true
rule_2_2_7: true
rule_2_2_8: true
rule_2_2_9: true
rule_2_2_10: true
rule_2_2_11: true
rule_2_2_12: true
rule_2_2_13: true
rule_2_2_14: true
rule_2_2_15: true
rule_2_2_16: true
rule_2_2_17: true
rule_2_2_18: true
rule_2_2_19: true
rule_2_2_20: true
rule_2_2_21: true
rule_2_2_22: true
rule_2_2_23: true
rule_2_2_24: true
rule_2_2_25: true
rule_2_2_26: true
rule_2_2_27: true
rule_2_2_28: true
rule_2_2_29: true
rule_2_2_30: true
rule_2_2_31: true
rule_2_2_32: true
rule_2_2_33: true
rule_2_2_34: true
rule_2_2_35: true
rule_2_2_36: true
rule_2_2_37: true
rule_2_2_38: true
rule_2_2_39: true
rule_2_2_40: true
rule_2_2_41: true
rule_2_2_42: true
rule_2_2_43: true
rule_2_2_44: true
rule_2_2_45: true
rule_2_2_46: true
rule_2_2_47: true
rule_2_2_48: true
rule_2_3_1_1: true
rule_2_3_1_2: true
rule_2_3_1_3: true
rule_2_3_1_4: true
rule_2_3_1_5: true
rule_2_3_1_6: true
rule_2_3_2_1: true
rule_2_3_2_2: true
rule_2_3_4_1: true
rule_2_3_4_2: true
rule_2_3_5_1: true
rule_2_3_5_2: true
rule_2_3_5_3: true
rule_2_3_5_4: true
rule_2_3_5_5: true
rule_2_3_6_1: true
rule_2_3_6_2: true
rule_2_3_6_3: true
rule_2_3_6_4: true
rule_2_3_6_5: true
rule_2_3_6_6: true
rule_2_3_7_1: true
rule_2_3_7_2: true
rule_2_3_7_3: true
rule_2_3_7_4: true
rule_2_3_7_5: true
rule_2_3_7_6: true
rule_2_3_7_7: true
rule_2_3_7_8: true
rule_2_3_7_9: true
rule_2_3_8_1: true
rule_2_3_8_2: true
rule_2_3_8_3: true
rule_2_3_9_1: true
rule_2_3_9_2: true
rule_2_3_9_3: true
rule_2_3_9_4: true
rule_2_3_9_5: true
rule_2_3_10_1: true
rule_2_3_10_2: true
rule_2_3_10_3: true
rule_2_3_10_4: true
rule_2_3_10_5: true
rule_2_3_10_6: true
rule_2_3_10_7: true
rule_2_3_10_8: true
rule_2_3_10_9: true
rule_2_3_10_10: true
rule_2_3_10_11: true
rule_2_3_10_12: true
rule_2_3_10_13: true
rule_2_3_11_1: true
rule_2_3_11_2: true
rule_2_3_11_3: true
rule_2_3_11_4: true
rule_2_3_11_5: true
rule_2_3_11_6: true
rule_2_3_11_7: true
rule_2_3_11_8: true
rule_2_3_11_9: true
rule_2_3_11_10: true
rule_2_3_13_1: true
rule_2_3_15_1: true
rule_2_3_15_2: true
rule_2_3_17_1: true
rule_2_3_17_2: true
rule_2_3_17_3: true
rule_2_3_17_4: true
rule_2_3_17_5: true
rule_2_3_17_6: true
rule_2_3_17_7: true
rule_2_3_17_8: true

# section 5
rule_5_1: true
rule_5_2: true

# section09
rule_9_1_1: true
rule_9_1_2: true
rule_9_1_3: true
rule_9_1_4: true
rule_9_1_5: true
rule_9_1_6: true
rule_9_1_7: true
rule_9_1_8: true
rule_9_2_1: true
rule_9_2_2: true
rule_9_2_3: true
rule_9_2_4: true
rule_9_2_5: true
rule_9_2_6: true
rule_9_2_7: true
rule_9_2_8: true
rule_9_3_1: true
rule_9_3_2: true
rule_9_3_3: true
rule_9_3_4: true
rule_9_3_5: true
rule_9_3_6: true
rule_9_3_7: true
rule_9_3_8: true
rule_9_3_9: true
rule_9_3_10: true

# section17
rule_17_1_1: true
rule_17_1_2: true
rule_17_1_3: true
rule_17_2_1: true
rule_17_2_2: true
rule_17_2_3: true
rule_17_2_4: true
rule_17_2_5: true
rule_17_2_6: true
rule_17_3_1: true
rule_17_3_2: true
rule_17_4_1: true
rule_17_4_2: true
rule_17_5_1: true
rule_17_5_2: true
rule_17_5_3: true
rule_17_5_4: true
rule_17_5_5: true
rule_17_5_6: true
rule_17_6_1: true
rule_17_6_2: true
rule_17_6_3: true
rule_17_6_4: true
rule_17_7_1: true
rule_17_7_2: true
rule_17_7_3: true
rule_17_7_4: true
rule_17_7_5: true
rule_17_8_1: true
rule_17_9_1: true
rule_17_9_2: true
rule_17_9_3: true
rule_17_9_4: true
rule_17_9_5: true

# section18
rule_18_1_1_1: true
rule_18_1_1_2: true
rule_18_1_2_2: true
rule_18_1_3: true
rule_18_2_1: true
rule_18_2_2: true
rule_18_2_3: true
rule_18_2_4: true
rule_18_2_5: true
rule_18_2_6: true
rule_18_3_1: true
rule_18_3_2: true
rule_18_3_3: true
rule_18_3_4: true
rule_18_3_5: true
rule_18_3_6: true
rule_18_3_7: true
rule_18_4_1: true
rule_18_4_2: true
rule_18_4_3: true
rule_18_4_4: true
rule_18_4_5: true
rule_18_4_6: true
rule_18_4_7: true
rule_18_4_8: true
rule_18_4_9: true
rule_18_4_10: true
rule_18_4_11: true
rule_18_4_12: true
rule_18_5_4_1: true
rule_18_5_4_2: true
rule_18_5_5_1: true
rule_18_5_8_1: true
rule_18_5_9_1: true
rule_18_5_9_2: true
rule_18_5_10_2: true
rule_18_5_11_2: true
rule_18_5_11_3: true
rule_18_5_11_4: true
rule_18_5_14_1: true
rule_18_5_19_2_1: true
rule_18_5_20_1: true
rule_18_5_20_2: true
rule_18_5_21_1: true
rule_18_5_21_2: true
rule_18_6_1: true
rule_18_6_2: true
rule_18_6_3: true
rule_18_7_1_1: true
rule_18_8_3_1: true
rule_18_8_4_1: true
rule_18_8_4_2: true
rule_18_8_5_1: true
rule_18_8_5_2: true
rule_18_8_5_3: true
rule_18_8_5_4: true
rule_18_8_5_5: true
rule_18_8_5_6: true
rule_18_8_5_7: true
rule_18_8_7_2: true
rule_18_8_14_1: true
rule_18_8_21_2: true
rule_18_8_21_3: true
rule_18_8_21_4: true
rule_18_8_21_5: true
rule_18_8_22_1_1: true
rule_18_8_22_1_2: true
rule_18_8_22_1_3: true
rule_18_8_22_1_4: true
rule_18_8_22_1_5: true
rule_18_8_22_1_6: true
rule_18_8_22_1_7: true
rule_18_8_22_1_8: true
rule_18_8_22_1_9: true
rule_18_8_22_1_10: true
rule_18_8_22_1_11: true
rule_18_8_22_1_12: true
rule_18_8_22_1_13: true
rule_18_8_25_1: true
rule_18_8_26_1: true
rule_18_8_27_1: true
rule_18_8_28_1: true
rule_18_8_28_2: true
rule_18_8_28_3: true
rule_18_8_28_4: true
rule_18_8_28_5: true
rule_18_8_28_6: true
rule_18_8_28_7: true
rule_18_8_31_1: true
rule_18_8_31_2: true
rule_18_8_34_6_1: true
rule_18_8_34_6_2: true
rule_18_8_34_6_3: true
rule_18_8_34_6_4: true
rule_18_8_36_1: true
rule_18_8_36_2: true
rule_18_8_37_1: true
rule_18_8_37_2: true
rule_18_8_40_1: true
rule_18_8_45_5_1: true
rule_18_8_47_5_1: true
rule_18_8_47_11_1: true
rule_18_8_49_1: true
rule_18_8_52_1_1: true
rule_18_8_52_1_2: true
rule_18_9_4_1: true
rule_18_9_6_1: true
rule_18_9_8_1: true
rule_18_9_8_2: true
rule_18_9_8_3: true
rule_18_9_10_1_1: true
rule_18_9_12_1: true
rule_18_9_13_1: true
rule_18_9_14_1: true
rule_18_9_14_2: true
rule_18_9_15_1: true
rule_18_9_15_2: true
rule_18_9_16_1: true
rule_18_9_16_2: true
rule_18_9_17_1: true
rule_18_9_17_2: true
rule_18_9_17_3: true
rule_18_9_17_4: true
rule_18_9_17_5: true
rule_18_9_17_6: true
rule_18_9_17_7: true
rule_18_9_17_8: true
rule_18_9_26_1_1: true
rule_18_9_26_1_2: true
rule_18_9_26_2_1: true
rule_18_9_26_2_2: true
rule_18_9_26_3_1: true
rule_18_9_26_3_2: true
rule_18_9_26_4_1: true
rule_18_9_26_4_2: true
rule_18_9_30_2: true
rule_18_9_30_3: true
rule_18_9_30_4: true
rule_18_9_39_1: true
rule_18_9_43_1: true
rule_18_9_44_1: true
rule_18_9_45_3_1: true
rule_18_9_45_3_2: true
rule_18_9_45_4_1_1: true
rule_18_9_45_4_1_2: true
rule_18_9_45_4_3_1: true
rule_18_9_45_5_1: true
rule_18_9_45_10_1: true
rule_18_9_45_11_1: true
rule_18_9_45_11_2: true
rule_18_9_45_14: true
rule_18_9_45_15: true
rule_18_9_47_9_1: true
rule_18_9_47_9_2: true
rule_18_9_47_9_3: true
rule_18_9_47_9_4: true
rule_18_9_55_1: true
rule_18_9_62_2_2: true
rule_18_9_62_3_2_1: true
rule_18_9_62_3_3_1: true
rule_18_9_62_3_3_2: true
rule_18_9_62_3_3_3: true
rule_18_9_62_3_3_4: true
rule_18_9_62_3_9_1: true
rule_18_9_62_3_9_2: true
rule_18_9_62_3_9_3: true
rule_18_9_62_3_9_4: true
rule_18_9_62_3_9_5: true
rule_18_9_62_3_10_1: true
rule_18_9_62_3_10_2: true
rule_18_9_62_3_11_1: true
rule_18_9_62_3_11_2: true
rule_18_9_63_1: true
rule_18_9_64_2: true
rule_18_9_64_3: true
rule_18_9_69_1: true
rule_18_9_80_1_1: true
rule_18_9_84_1: true
rule_18_9_84_2: true
rule_18_9_85_1: true
rule_18_9_85_2: true
rule_18_9_85_3: true
rule_18_9_86_1: true
rule_18_9_97_1_1: true
rule_18_9_97_1_2: true
rule_18_9_97_1_3: true
rule_18_9_97_2_1: true
rule_18_9_97_2_2: true
rule_18_9_97_2_3: true
rule_18_9_97_2_4: true
rule_18_9_98_1: true
rule_18_9_99_2_1: true
rule_18_9_100_1: true
rule_18_9_100_2: true
rule_18_9_108_1_1: true
rule_18_9_108_2_1: true
rule_18_9_108_2_2: true
rule_18_9_108_4_1: true
rule_18_9_108_4_2: true
rule_18_9_108_4_3: true

# section19
rule_19_1_3_1: true
rule_19_1_3_2: true
rule_19_1_3_3: true
rule_19_1_3_4: true
rule_19_5_1_1: true
rule_19_6_6_1_1: true
rule_19_7_4_1: true
rule_19_7_4_2: true
rule_19_7_8_1: true
rule_19_7_8_2: true
rule_19_7_8_3: true
rule_19_7_8_4: true
rule_19_7_8_5: true
rule_19_7_28_1: true
rule_19_7_43_1: true
rule_19_7_47_2_1: true

# Section 2 Variables

# 2.2.18
# is_hyperv_installed is Hyper-V installed
is_hyperv_installed: false

# 2.3.1.5
# win19cis_admin_username is the name the administrator account will be renamed to
win19cis_admin_username: adminchangethis

# 2.3.1.6
# win19cis_guest_username is the name the guest account will be renamed to
win19cis_guest_username: guestchangethis

# This SID is the same for standalone, member, domain controller for 'Administrators' group
sedebugprivilege: "*S-1-5-32-544"

pass_age: 60

# 1.2.2
# lockoutbadcount must be 5 or few, but not 0 (zero)
lockoutbadcount: 5

resetlockoutcount: 15
passwordhistorysize: 24

# 1.1.2
# maximumpasswordage must be 365 or fewer, but not 0 (zero)
maximumpasswordage: 365

minimumpasswordage: 1
minimumpasswordlength: 14

newadministratorname: renamedadmin
newguestname: renamedguest

legalnoticetext: |
    You are about to access a private system. Unauthorized access to, or use of, this system is strictly prohibited.
    Unauthorized access to, or misuse of, any data on this system is also strictly prohibited. All attempts to access
    this system, whether successful or not, are monitored and recorded. You should have no expectation of privacy
    when using this system. By continuing, you agree to these conditions, unauthorized use may be subject to
    discipline and applicable law.
app_maxsize: 32768
sec_maxsize: 196608
sys_maxsize: 32768


legalnoticecaption: "DoD Notice and Consent Banner"

# 2.2.33
# Window Manager\Window Manager Group only exists on non Core installations
# windows_installation_type should be 'Server Core' for Core installations
# This is a variable to determine if Windows Manager should be included in this step
increase_scheduling_priority_users: '{{ ["Administrators"] if (windows_installation_type=="Server Core") else (["Administrators","Window Manager\Window Manager Group"]) }}'

# 9.1.5
# domain_firewall_log_path is the path to the domain firewall log files. The control suggests %SystemRoot%\System32\logfiles\firewall\domainfw.log
# This is a variable to give some leway on where to store these log files
domain_firewall_log_path: '%SystemRoot%\System32\logfiles\firewall\domainfw.log'

# 9.1.6
# domain_firewall_log_size is the size of the log file generated
# To conform to CIS standards the value should be 16,384 or greater. Value is in KB
domain_firewall_log_size: 16,384

# 9.2.5
# private_firewall_log_path is the path to the private firewall log files. The control suggests %SystemRoot%\System32\logfiles\firewall\privatefw.log
# This is a variable to give some leway on where to store these log files
private_firewall_log_path: '%SystemRoot%\System32\logfiles\firewall\privatefw.log'

# 9.2.6
# private_firewall_log_size is the size of the log file
# To conform to CIS stadnards the value should be 16,384 or greater. Value is in KB
private_firewall_log_size: 16,384

# 9.3.7
# public_firewall_log_path is the path to the public firewall log file. The control suggests %SystemRoot%\System32\logfiles\firewall\publicfw.log
# This is a variable to give some leway on where to store these log files
public_firewall_log_path: '%SystemRoot%\System32\logfiles\firewall\publicfw.log'

# 9.3.8
# public_firewall_log_size is the size of the log file
# To conform to CIS stadnards the value should be 16,384 or greater. Value is in KB
public_firewall_log_size: 16,384

# Control 18.2.5
# laps_passwordlength is the LAPS tool password length.
# To conform to CIS standards please use a min value of 15 and max value of 127
laps_passwordlength: 15

# Control 18.2.6
# laps_passwordagedays is the LAPS tool password age in days
# To conform to CIS standards please use a max value of 30
laps_passwordagedays: 30

# 18.3.6
# netbt_nodetype is the node type value in HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NetBT\Parameters:NodeType
# Options are B-node value of 1, P-node value of 2, M-node value of 4, H-node value of 8. P-node is the recommended setting from CIS
netbt_nodetype: 2
----

== Packer Setup



== Ansible Project and Roles

== Ansible Controller

== Variables

== Play by Play

== How to make changes and updates

== Final Thoughts